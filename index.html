<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Blog of Gavin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Blog of Gavin">
<meta property="og:url" content="http://germanyt.github.io/index.html">
<meta property="og:site_name" content="Blog of Gavin">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Blog of Gavin">
<meta name="twitter:description">
<meta name="twitter:creator" content="@GermanyTang">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-40267048-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Blog of Gavin</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://germanyt.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-How-to-write-your-own-Virtual-DOM" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/How-to-write-your-own-Virtual-DOM/" class="article-date">
  <time datetime="2016-06-02T06:21:30.000Z" itemprop="datePublished">2016-06-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/How-to-write-your-own-Virtual-DOM/">如何自己实现虚拟DOM</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>原文地址：<a href="https://medium.com/@deathmood/how-to-write-your-own-virtual-dom-ee74acc13060#.8eontjd52" target="_blank" rel="external">medium.com @deathmood</a></p>
<p>自己实现虚拟DOM需要知道两件事情。你不需要深入研究 React 源码或者其它的实现源码，他们非常庞大和复杂，但是真正实现虚拟DOM部分的代码不到50行。50行代码！！！</p>
<p>这里有两个概念：</p>
<ul>
<li>虚拟DOM是任何一种真实DOM的表现形式</li>
<li>改变虚拟DOM树中的东西，我们将获得一个新的虚拟DOM树。通过算法来比较这两个树（新的和旧的虚拟树），找出不同点。然后对应虚拟树在真实DOM树中做最小的必要改变。</li>
</ul>
<p>就是这样！让我们一起来深入理解每个概念。</p>
<h2 id="表示-DOM-树"><a href="#表示-DOM-树" class="headerlink" title="表示 DOM 树"></a>表示 DOM 树</h2><p>首先需要以某种方式将DOM树存储在内存中。我们可以用原生 Object 来做这件事。假设我们有一个这样的树：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>item 1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>item 2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>看起来很简单，不是吗？我们怎样只用JS对象来表示它呢？<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123; type: <span class="string">'ul'</span>, props: &#123; <span class="string">'class'</span>: <span class="string">'list'</span> &#125;, children: [</span><br><span class="line">  &#123; type: <span class="string">'li'</span>, props: &#123;&#125;, children: [<span class="string">'item 1'</span>] &#125;,</span><br><span class="line">  &#123; type: <span class="string">'li'</span>, props: &#123;&#125;, children: [<span class="string">'item 2'</span>] &#125;</span><br><span class="line">] &#125;</span><br></pre></td></tr></table></figure></p>
<p>这里我们需要注意两点：</p>
<ul>
<li><p>我们用对象表示DOM元素</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; type: <span class="string">'…'</span>, props: &#123; … &#125;, children: [ … ] &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>我们用原生JS字符串表示DOM文本节点</p>
</li>
</ul>
<p>但是用这样的方法写一个大树是很困难的。所以我们写一个辅助函数，她能让我们更容易理解结构：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params">type, props, …children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; type, props, children &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在，我们可以像这样来写DOM树：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">h(<span class="string">'ul'</span>, &#123; <span class="string">'class'</span>: <span class="string">'list'</span> &#125;,</span><br><span class="line">  h(<span class="string">'li'</span>, &#123;&#125;, <span class="string">'item 1'</span>),</span><br><span class="line">  h(<span class="string">'li'</span>, &#123;&#125;, <span class="string">'item 2'</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>它看起来简洁多了，不是吗？但是我们可以更进一步。你听说过 JSX 吗？是的，在这里我想用它。它是怎么工作的？</p>
<p>如果你读过<a href="https://babeljs.io/docs/plugins/transform-react-jsx/" target="_blank" rel="external">这里</a>的官方 Babel JSX 文档，你将会知道，Babel 编译这段代码：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>item 1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>item 2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>像这样：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">React.createElement(<span class="string">'ul'</span>, &#123; className: <span class="string">'list'</span> &#125;,</span><br><span class="line">  React.createElement(<span class="string">'li'</span>, &#123;&#125;, <span class="string">'item 1'</span>),</span><br><span class="line">  React.createElement(<span class="string">'li'</span>, &#123;&#125;, <span class="string">'item 2'</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>注意到有一些相似？是的是的。如果我们能将 <code>React.createElement(…)</code> 替换成我们的 <code>h(…)</code>。事实上我们可以这样做——通过用叫做 <code>jsx pragma</code> 的东西。我们只需要在文件顶部写一行类注释的内容：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/** @jsx h */</span><br><span class="line">&lt;ul className="list"&gt;</span><br><span class="line">  &lt;li&gt;item 1&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;item 2&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure></p>
<p>它告诉 Babel “嘿，编译 JSX 但是要用 <code>h</code> 代替 <code>React.createElement</code>。” 在这你可以用任意一个函数代替 <code>h</code> 进行编译。</p>
<p>所以，像我前面说的那样，我们将用这种方法写DOM：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** @jsx h */</span></span><br><span class="line"><span class="keyword">const</span> a = (</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>item 1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>item 2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>它将会被 Babel 编译成这样：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = (</span><br><span class="line">  h(<span class="string">'ul'</span>, &#123; className: <span class="string">'list'</span> &#125;,</span><br><span class="line">    h(<span class="string">'li'</span>, &#123;&#125;, <span class="string">'item 1'</span>),</span><br><span class="line">    h(<span class="string">'li'</span>, &#123;&#125;, <span class="string">'item 2'</span>),</span><br><span class="line">  );</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>当函数 <code>h</code> 执行的时候，它会返回一个原生JS对象——我们虚拟DOM表示：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = (</span><br><span class="line">  &#123; type: <span class="string">'ul'</span>, props: &#123; className: <span class="string">'list'</span> &#125;, children: [</span><br><span class="line">    &#123; type: <span class="string">'li'</span>, props: &#123;&#125;, children: [<span class="string">'item 1'</span>] &#125;,</span><br><span class="line">    &#123; type: <span class="string">'li'</span>, props: &#123;&#125;, children: [<span class="string">'item 2'</span>] &#125;</span><br><span class="line">  ] &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>开始吧！在 JSFiddle 中尝试（不要忘记设置语言为 Babel ）：<br><iframe scrolling="no" width="100%" height="300" src="http://jsfiddle.net/5qyLubt4/embedded/js,resources,html,css,result/light" frameborder="0" allowfullscreen></iframe></p>
<h2 id="应用我们的-DOM-表示法"><a href="#应用我们的-DOM-表示法" class="headerlink" title="应用我们的 DOM 表示法"></a>应用我们的 DOM 表示法</h2><p>好了，现在我们已经用自己的结构的原生对象表示了我们的 DOM 树。这非常酷，但是我们需要用它以一种方式创建真实的DOM树，我们不能只将我们的表示法附加到 DOM 中。</p>
<p>首先让我们做一些假设和定义一些术语：</p>
<ul>
<li>所有的真实 DOM 节点（元素和文本节点）变量将会用 <code>$</code> 开头——因此 <code>$parent</code> 将会是一个真实的 DOM 元素</li>
<li>虚拟节点表示法将指定变量名为 <code>node</code></li>
<li>像在 React 中，你只能有一个根节点——所有的其他节点都在里面</li>
</ul>
<p>好了，像这样说的，让我们写一个能将虚拟 DOM 节点转化成真实 DOM 节点的函数 <code>createElement(…)</code> 。现在先忽略 <code>props</code> 和 <code>children</code> ——我们以后将创建它：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createElement</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> node === <span class="string">'string'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.createTextNode(node);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">document</span>.createElement(node.type);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>因为我们有文本节点（原生字符串）和 Elements(含有 type 的JS对象）像这样：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; type: <span class="string">'…'</span>, props: &#123; … &#125;, children: [ … ] &#125;</span><br></pre></td></tr></table></figure></p>
<p>因此，我们能传递虚拟的文本节点和虚拟的 element 节点，它都能工作。<br>现在，让我们一起来思考子节点——他们每一个不是文本节点就是 Element 节点。所以它们也能被 <code>createElement(…)</code> 函数创建。耶，你感觉到了吗？它感觉像是递归。所以我们能为每个元素子节点调用 <code>createElement(…)</code> ，然后像这样 <code>appendChild()</code> 它们到我们的元素中：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createElement</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> node === ‘string’) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.createTextNode(node);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> $el = <span class="built_in">document</span>.createElement(node.type);</span><br><span class="line">  node.children</span><br><span class="line">    .map(createElement)</span><br><span class="line">    .forEach($el.appendChild.bind($el));</span><br><span class="line">  <span class="keyword">return</span> $el;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>哇哦，看起来很不错。现在我们先把 <code>props</code> 放在一边，以后再讨论它。我们不需要它来理解虚拟DOM的基础概念，但是它却会增加复杂度。</p>
<p>现在开始让我们在 JSFiddle 中尝试它：<br><iframe scrolling="no" width="100%" height="300" src="http://jsfiddle.net/cL0Lc7au/embedded/js,resources,html,css,result/light" frameborder="0" allowfullscreen></iframe></p>
<h2 id="变化处理"><a href="#变化处理" class="headerlink" title="变化处理"></a>变化处理</h2><p>我们已经能把虚拟DOM转换成真实DOM，现在思考虚拟DOM树之间的差别。我们需要写一个来对比两个虚拟DOM树（新和旧）并在真实DOM树中只做必要改变的算法。</p>
<p>怎么对比树？我们需要下面几种情况：</p>
<ul>
<li>对应位置没有旧的节点——需要 <code>appendChild(…)</code> 添加节点<br><img src="https://cdn-images-1.medium.com/max/800/1*GFUWrX6pBgiDQ5Z-IvzjUw.png" alt="对应位置没有旧的节点"></li>
<li>对应位置没有新的节点——需要 <code>removeChild(…)</code> 删除节点<br><img src="https://cdn-images-1.medium.com/max/800/1*VRoYwAeWPF0jbiWXsKb2HA.png" alt="对应位置没有新的节点"></li>
<li>对应位置有不同的节点——需要 <code>replaceChild(…)</code> 替换节点<br><img src="https://cdn-images-1.medium.com/max/800/1*6iQYEH0APjbuPvYmnD7Qlw.png" alt="对应位置没有新的节点"></li>
<li>节点相同——需要进一步对比子节点<br><img src="https://cdn-images-1.medium.com/max/800/1*x1Eq-uuqgL0z9d9qn_opww.png" alt="节点相同"></li>
</ul>
<p>好了，我们写一个 <code>updateElement(…)</code> 函数，传递三个参数（$parent, newNode and oldNode）给它，<code>$parent</code> 是虚拟节点对应的真实节点的父节点。现在我们来看怎么处理上面描述的几种情况。</p>
<h2 id="没有旧节点"><a href="#没有旧节点" class="headerlink" title="没有旧节点"></a>没有旧节点</h2><p>这是非常简单的：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateElement</span>(<span class="params">$parent, newNode, oldNode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!oldNode) &#123;</span><br><span class="line">    $parent.appendChild(</span><br><span class="line">      createElement(newNode)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="没有新节点"><a href="#没有新节点" class="headerlink" title="没有新节点"></a>没有新节点</h2><p>这里有个问题——如果新虚拟树的当前位置没有节点，我们应该在真实DOM中移除它，但是我们应该怎么做呢？我们知道父元素（已被传递到函数中），因此我们假设调用 <code>$parent.removeChild(…)</code> 并传递真实DOM的引用给它。但是我们没有真实DOM的引用。如果我们知道节点在父元素中的位置，我们能够通过 <code>$parent.childNodes[index]</code> 得到它的引用， <code>index</code> 就是节点在父元素中的索引。</p>
<p>我们假设 <code>index</code> 会传递给函数（后面你会看到它真的会被传递）。因此我们的代码会变成这样：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateElement</span>(<span class="params">$parent, newNode, oldNode, index = 0</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!oldNode) &#123;</span><br><span class="line">    $parent.appendChild(</span><br><span class="line">      createElement(newNode)</span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!newNode) &#123;</span><br><span class="line">    $parent.removeChild(</span><br><span class="line">      $parent.childNodes[index]</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="节点变化"><a href="#节点变化" class="headerlink" title="节点变化"></a>节点变化</h2><p>首先我们需要一个对比两个节点的函数来告诉我们节点是否改变。我们应该考虑 elements 和文本节点：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changed</span>(<span class="params">node1, node2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> node1 !== <span class="keyword">typeof</span> node2 ||</span><br><span class="line">         <span class="keyword">typeof</span> node1 === ‘string’ &amp;&amp; node1 !== node2 ||</span><br><span class="line">         node1.type !== node2.type</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在我们已经有了当前节点在父元素的索引 (<code>index</code>) ，我们能很容易用新创建的节点替换它：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateElement</span>(<span class="params">$parent, newNode, oldNode, index = 0</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!oldNode) &#123;</span><br><span class="line">    $parent.appendChild(</span><br><span class="line">      createElement(newNode)</span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!newNode) &#123;</span><br><span class="line">    $parent.removeChild(</span><br><span class="line">      $parent.childNodes[index]</span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (changed(newNode, oldNode)) &#123;</span><br><span class="line">    $parent.replaceChild(</span><br><span class="line">      createElement(newNode),</span><br><span class="line">      $parent.childNodes[index]</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="比较子节点"><a href="#比较子节点" class="headerlink" title="比较子节点"></a>比较子节点</h2><p>最后，但是并非不重要的。我们应该遍历每个节点的子节点并对比它们，通过调用 <code>updateElement(…)</code> 。是的，又是递归。<br>但是有些写代码之前需要考虑的事情：</p>
<ul>
<li>我们应该比较只有节点是 Element 的子节点（文本节点没有子节点）</li>
<li>传递当前节点的引用作为父节点</li>
<li>必须一个一个的比较子节点，即使有些地方我们只有 “undefined” 这都是没问题的，我们的函数可以处理</li>
<li>最后，<code>index</code>——它只是子节点在子节点数组中的索引</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateElement</span>(<span class="params">$parent, newNode, oldNode, index = 0</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!oldNode) &#123;</span><br><span class="line">    $parent.appendChild(</span><br><span class="line">      createElement(newNode)</span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!newNode) &#123;</span><br><span class="line">    $parent.removeChild(</span><br><span class="line">      $parent.childNodes[index]</span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (changed(newNode, oldNode)) &#123;</span><br><span class="line">    $parent.replaceChild(</span><br><span class="line">      createElement(newNode),</span><br><span class="line">      $parent.childNodes[index]</span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newNode.type) &#123;</span><br><span class="line">    <span class="keyword">const</span> newLength = newNode.children.length;</span><br><span class="line">    <span class="keyword">const</span> oldLength = oldNode.children.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; newLength || i &lt; oldLength; i++) &#123;</span><br><span class="line">      updateElement(</span><br><span class="line">        $parent.childNodes[index],</span><br><span class="line">        newNode.children[i],</span><br><span class="line">        oldNode.children[i],</span><br><span class="line">        i</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="所有的代码放在一起"><a href="#所有的代码放在一起" class="headerlink" title="所有的代码放在一起"></a>所有的代码放在一起</h2><p>我们把所有的代码放在 JSFiddle， 就像我承诺的一样它的执行部分只有50行代码。我们来看看：<br><iframe scrolling="no" width="100%" height="300" src="http://jsfiddle.net/0htedLra/embedded/js,resources,html,css,result/light" frameborder="0" allowfullscreen></iframe><br>打开开发者工具，观察点击 “Reload” 按钮时变化的应用。<br><img src="https://cdn-images-1.medium.com/max/800/1*e1s_Zc_fVxL3i0un2ZNEtg.gif" alt=""></p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>恭喜！我们已经做到了。我们写一个虚拟DOM的执行程序，它工作的很好。我希望通过阅读这篇文章，你能够理解虚拟DOM和React底层的运行机制。</p>
<p>然而有些事情我们并没有在这里介绍。（在后面的文章中我会尝试着覆盖到它们）</p>
<ul>
<li>设置／对比／更新 Element 属性（props）</li>
<li>处理事件——在 Elements 上添加事件监听</li>
<li>像React一样在组件中使用虚拟DOM</li>
<li>真正的 DOM 节点引用</li>
<li>在直接改变真实 DOM 的库中使用虚拟DOM——像 jQuery 和它的插件一样</li>
<li>以及更多的内容…</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://germanyt.github.io/How-to-write-your-own-Virtual-DOM/" data-id="ciozdneig0001kdwp8utvj6eo" class="article-share-link">Share</a>
      
        <a href="http://germanyt.github.io/How-to-write-your-own-Virtual-DOM/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Translate/">Translate</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-React-study-notes-4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/React-study-notes-4/" class="article-date">
  <time datetime="2016-05-20T07:28:33.000Z" itemprop="datePublished">2016-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/React-study-notes-4/">React 学习笔记 - 4</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前边几节中学习了组件和路由控制，已经能够做一个静态的SPA了。但是对于一个富应用来说，我们只学习了View，接下来我们将要学习数据处理模块，在正式开始学习之前，先来介绍下这位新朋友。</p>
<h2 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h2><p>Redux 是 JavaScript 状态容器，提供可预测化的状态管理。可以让你构建一致化的应用，运行于不同的环境（客户端、服务器、原生应用），并且易于测试。Redux 由 Flux 演变而来，但受 Elm 的启发，避开了 Flux 的复杂性。<br>Redux 规定，将模型的更新逻辑全部集中于 <code>reducer</code> 层，不允许程序直接修改数据，而是用一个叫作 <code>action</code> 的普通对象来对更改进行描述。</p>
<h2 id="三个基本原则"><a href="#三个基本原则" class="headerlink" title="三个基本原则"></a>三个基本原则</h2><ol>
<li>单一数据源<br> 整个应用只存在一个 Object tree，并且 Object tree 只存在于唯一的 store 中。</li>
<li>State 是只读的<br> 唯一改变 state 的方法就是触发 action</li>
<li>使用纯函数来执行修改<br> 为了描述 action 如何改变 state tree ，你需要编写 reducers。</li>
</ol>
<h2 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h2><p><code>action</code>是把数据从应用传到 Store 的载体，是 Store 数据的唯一来源。</p>
<ul>
<li>示例Action：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ADD_MESSAGE = <span class="string">'ADD_MESSAGE'</span>;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  type: ADD_MESSAGE,</span><br><span class="line">  data</span><br><span class="line">  <span class="comment">// 其它数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这里约定，action 内必须使用一个字符串类型的 type 字段来表示将要执行的动作。建议在单独的模块或文件中使用常量定义，以方便维护。</p>
<h4 id="Action-创建函数"><a href="#Action-创建函数" class="headerlink" title="Action 创建函数"></a>Action 创建函数</h4><p>Action 创建函数，是一个返回action的简单函数，这样做方便移植和测试。</p>
<ul>
<li>示例<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addMessage</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: ADD_MESSAGE,</span><br><span class="line">    data</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Redux 中只需把 action 创建函数的结果传给 <code>dispatch()</code> 方法即可发起一次 dispatch 过程。</p>
<h2 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h2><p>Action 描述了事情已经发生，Reducer来执行具体如何更新state。</p>
<ol>
<li><p>先设计state的结构，以一个消息列表为例：</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  list: [</span><br><span class="line">    &#123;</span><br><span class="line">      text: <span class="string">'Consider using Redux'</span>,</span><br><span class="line">      create_time: <span class="string">'2016-05-21 12:22:56'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      text: <span class="string">'Keep all state in a single tree'</span>,</span><br><span class="line">      create_time: <span class="string">'2016-05-21 12:22:56'</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Action 处理<br> reducer 就是一个纯函数，接收旧的 state 和 action，返回新的 state。</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;ADD_MESSAGE&#125; <span class="keyword">from</span> <span class="string">'../actions/constants'</span>;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> initState = &#123;</span><br><span class="line">   list: []</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">Message</span>(<span class="params">state = initState, action</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">switch</span>(action.type)&#123;</span><br><span class="line">     <span class="keyword">case</span> ADD_MESSAGE:</span><br><span class="line">       <span class="comment">// return Object.assign(&#123;&#125;, state, &#123;</span></span><br><span class="line">       <span class="comment">//   list: [...state.list, action.data]</span></span><br><span class="line">       <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">let</span> list = [...state.list, action.data];</span><br><span class="line">       <span class="keyword">return</span> &#123; ...state, list &#125;;</span><br><span class="line">     <span class="keyword">default</span>:</span><br><span class="line">       <span class="keyword">return</span> state;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> action参数的值是 Action对象，在这里不要在state上直接进行修改，可以使用<code>Object.assign({}, state)</code> 或 其他库的 <code>_.assign()</code> 对state新建一个副本，第一个参数必须设置为空对象。还可以使用了ES7提案中的对象展开运算符，需要使用转换编译器，如Babel。Babel中使用 <a href="http://babeljs.io/docs/plugins/transform-object-rest-spread/" target="_blank" rel="external">babel-plugin-transform-object-rest-spread</a> 插件。</p>
<p> <em>注意：永远不要在reducer中做以下操作：</em></p>
<ul>
<li>修改传入参数；</li>
<li>执行有副作用的操作，如 API 请求和路由跳转；</li>
<li>调用非纯函数，如 Date.now() 或 Math.random()。</li>
</ul>
</li>
<li><p>多个Action<br> 要处理多个Action的时候，在switch中为每一个Action添加一个case。</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">message</span>(<span class="params">state = initState, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span>(action.type)&#123;</span><br><span class="line">     <span class="keyword">case</span> ADD_MESSAGE:</span><br><span class="line">       <span class="keyword">let</span> list = [...state.list, action.data];</span><br><span class="line">       <span class="keyword">return</span> &#123; ...state, list &#125;;</span><br><span class="line">     <span class="keyword">case</span> DELETE_MESSAGE:</span><br><span class="line">       <span class="keyword">let</span> index = action.index;</span><br><span class="line">       <span class="keyword">if</span>(index &gt;= <span class="number">0</span> &amp;&amp; index &lt; state.list.length)&#123;</span><br><span class="line">         <span class="keyword">let</span> list = [...state.list.slice(<span class="number">0</span>, index), ...state.list.slice(index+<span class="number">1</span>)];</span><br><span class="line">         <span class="keyword">return</span> &#123;...state, list&#125;;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> state;</span><br><span class="line">     <span class="keyword">default</span>:</span><br><span class="line">       <span class="keyword">return</span> state;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>多个reducer<br>多个Action时，需要合理的设计state结构，例如如下结构state，可以拆分filter和message为两个reducer。建议为每个reducer对应一个文件，应用庞大时可使用文件夹分类。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  filter: &#123;</span><br><span class="line">    key: <span class="string">'Redux'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  message: [</span><br><span class="line">    &#123;</span><br><span class="line">      text: <span class="string">'Consider using Redux'</span>,</span><br><span class="line">      create_time: <span class="string">'2016-05-21 12:22:56'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      text: <span class="string">'Keep all state in a single tree'</span>,</span><br><span class="line">      create_time: <span class="string">'2016-05-21 12:22:56'</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在我们在reducers文件夹下建两个reducer文件，分别命名为filter.reducer.js和message.reducer.js。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// filter.reducer.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; INPUT_FILTER_KEY &#125; <span class="keyword">from</span> <span class="string">'../actions/constants'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initState = &#123;</span><br><span class="line">  key: <span class="string">''</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">state = initState, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> INPUT_FILTER_KEY:</span><br><span class="line">      <span class="keyword">let</span> key = action.key || <span class="string">''</span>;</span><br><span class="line">      <span class="keyword">return</span> &#123;...state, key&#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// message.reducer.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;ADD_MESSAGE, DELETE_MESSAGE&#125; <span class="keyword">from</span> <span class="string">'../actions/constants'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initState = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">message</span>(<span class="params">state = initState, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span>(action.type)&#123;</span><br><span class="line">    <span class="keyword">case</span> ADD_MESSAGE:</span><br><span class="line">      <span class="keyword">return</span> [...state, action.data];</span><br><span class="line">    <span class="keyword">case</span> DELETE_MESSAGE:</span><br><span class="line">      <span class="keyword">let</span> index = action.index;</span><br><span class="line">      <span class="keyword">if</span>(index &gt;= <span class="number">0</span> &amp;&amp; index &lt; state.length)&#123;</span><br><span class="line">        <span class="keyword">return</span> [...state.slice(<span class="number">0</span>, index), ...state.slice(index+<span class="number">1</span>)];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于应用中只能存在单一的state树，所以我们需要将上面两个reducer合并成一个，Redux 提供了 <code>combineReducers()</code> 工具类来合并多个reducer。<br>现在我们在reducers文件夹下，新建一个 <code>index.js</code> 文件使用 <code>combineReducers()</code> 合并两个reducer：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> message <span class="keyword">from</span> <span class="string">'./message.reducer'</span>;</span><br><span class="line"><span class="keyword">import</span> filter <span class="keyword">from</span> <span class="string">'./filter.reducer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> messageApp = combineReducers( &#123;</span><br><span class="line">  message,</span><br><span class="line">  filter</span><br><span class="line">&#125; );</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> messageApp;</span><br></pre></td></tr></table></figure>
<p>注意上面的写法和下面完全等价：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> message <span class="keyword">from</span> <span class="string">'./message.reducer'</span>;</span><br><span class="line"><span class="keyword">import</span> filter <span class="keyword">from</span> <span class="string">'./filter.reducer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">messageApp</span>(<span class="params">state = &#123;&#125;, action</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    message: message(state.message, action),</span><br><span class="line">    filter: filter(state.filter, action)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h2><p>Store 就是把Action 和 reducer 联系到一起的对象。Store 有以下职责：</p>
<ul>
<li>维持应用的 state；</li>
<li>提供 <code>getState()</code> 方法获取 state；</li>
<li>提供 <code>dispatch(action)</code> 方法更新 state；</li>
<li>通过 <code>subscribe(listener)</code> 注册监听器;</li>
<li>通过 <code>subscribe(listener)</code> 返回的函数注销监听器。</li>
</ul>
<p>再次强调一下 <em>Redux 应用只有一个单一的 store</em>。当需要拆分数据处理逻辑时，你应该使用 reducer 组合 而不是创建多个 store。<br>根据已有的reducer创建store非常容易。现在我们导入前面合并后的reducer，并传递给 <code>ctreateStore()</code>。</p>
<ul>
<li>创建一个store文件<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> messageApp <span class="keyword">from</span> <span class="string">'../reducers'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = createStore(messageApp);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="发起Actions"><a href="#发起Actions" class="headerlink" title="发起Actions"></a>发起Actions</h2><p>现在我们已经建好了store，在没有页面的情况下就已经可以开始测试数据了。</p>
<ul>
<li>测试store<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;addMessage, deleteMessage, inputFilterKey&#125; <span class="keyword">from</span> <span class="string">'./actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(store.getState());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每次 state 更新时，打印日志</span></span><br><span class="line"><span class="comment">// 注意 subscribe() 返回一个函数用来注销监听器</span></span><br><span class="line"><span class="keyword">let</span> unsubscribe = store.subscribe(() =&gt;</span><br><span class="line">  <span class="built_in">console</span>.log(store.getState())</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发起一系列 action</span></span><br><span class="line">store.dispatch(addMessage(&#123;text: <span class="string">'Learn about actions'</span>, create_time: <span class="string">'2016-05-24 11:09:24'</span>&#125;));</span><br><span class="line">store.dispatch(addMessage(&#123;text: <span class="string">'Learn about reducers'</span>, create_time: <span class="string">'2016-05-24 11:09:24'</span>&#125;));</span><br><span class="line">store.dispatch(addMessage(&#123;text: <span class="string">'Learn about store'</span>, create_time: <span class="string">'2016-05-24 11:09:24'</span>&#125;));</span><br><span class="line">store.dispatch(deleteMessage(<span class="number">2</span>));</span><br><span class="line">store.dispatch(deleteMessage(<span class="number">0</span>));</span><br><span class="line">store.dispatch(inputFilterKey(<span class="string">'Learn'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 停止监听 state 更新</span></span><br><span class="line">unsubscribe();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="连接Redux"><a href="#连接Redux" class="headerlink" title="连接Redux"></a>连接Redux</h2><p>在我们已经写好页面的情况下，如何将页面组件与Store连接？<br>我们用 <code>react-redux</code> 提供的 <code>connect()</code> 方法，将Message Component 转化成容器组件。</p>
<ul>
<li>containers/message.container.js<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Message &#125; <span class="keyword">from</span> <span class="string">'../components/'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; addMessage, deleteMessage, inpuFilterKey &#125; <span class="keyword">from</span> <span class="string">'../actions'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 哪些 action 创建函数是我们想要通过 props 获取的？</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    onAddMessage: (data) =&gt; dispatch(addMessage(data)),</span><br><span class="line">    onDeleteMessage: (index) =&gt; dispatch(deleteMessage(index)),</span><br><span class="line">    onChangeFilterKey: (key) =&gt; dispatch(inputFilterKey(key))</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filterMessage</span>(<span class="params">messages, filter_key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(filter_key)&#123;</span><br><span class="line">    <span class="keyword">var</span> messageList = [];</span><br><span class="line">    messages.map( (message, index) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>( ~message.text.indexOf(filter_key) )&#123;</span><br><span class="line">        messageList.push(&#123;</span><br><span class="line">          id: index,</span><br><span class="line">          text: message.text,</span><br><span class="line">          create_time: message.create_time</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> messageList;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> messages;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 哪些 Redux 全局的 state 是我们组件想要通过 props 获取的？</span></span><br><span class="line"><span class="comment">// 这里我们还使用了 filterMessage 来根据filter_key 筛选出相匹配的 message</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    messages: filterMessage(state.message, state.filter.key),</span><br><span class="line">    filter_key: state.filter.key</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">  mapStateToProps,</span><br><span class="line">  mapDispatchToProps</span><br><span class="line">)(Message);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>到此，我们已经可以使用Redux来管理React数据了，但是当我们需要和服务器进行交互或者是需要进行非纯函数操作时，应该怎么做呢？</p>
<h2 id="异步Action"><a href="#异步Action" class="headerlink" title="异步Action"></a>异步Action</h2><p>在使用异步Action时，一般情况下每个请求都要dispatch三个不同的Action，为了区分不同的Action，我们建议为他们定义不同的type。<br>上面 addMessage 的create_time值都是静态数据，现在我们想动态的获取create time。</p>
<ul>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; type: <span class="string">'GET_TIME_REQUEST'</span> &#125;</span><br><span class="line">&#123; type: <span class="string">'GET_TIME_FAILURE'</span>, error: <span class="string">'error info'</span> &#125;</span><br><span class="line">&#123; type: <span class="string">'GET_TIME_SUCCESS'</span>, data: &#123; ... &#125; &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li><p>创建Action</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addMessage</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// return &#123;</span></span><br><span class="line">  <span class="comment">//   type: ADD_MESSAGE,</span></span><br><span class="line">  <span class="comment">//   data</span></span><br><span class="line">  <span class="comment">// &#125;;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dispatch =&gt; &#123;</span><br><span class="line">    dispatch( getTimeRequest() );</span><br><span class="line">    getTime().then(time =&gt; &#123;</span><br><span class="line">      dispatch( getTimeSuccess() );</span><br><span class="line"></span><br><span class="line">      data.create_time = time;</span><br><span class="line"></span><br><span class="line">      dispatch( addMessageToStore(data) );</span><br><span class="line"></span><br><span class="line">    &#125;).catch(error =&gt; dispatch( getTimeFailure(error &amp;&amp; error.message || error) ));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addMessageToStore</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: ADD_MESSAGE,</span><br><span class="line">    data</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTimeRequest</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: GET_TIME_REQUEST</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTimeFailure</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: GET_TIME_FAILURE,</span><br><span class="line">    error</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTimeSuccess</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: GET_TIME_SUCCESS,</span><br><span class="line">    data</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTime</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> time = moment().format(<span class="string">'YYYY-MM-DD HH:mm:ss'</span>);</span><br><span class="line"></span><br><span class="line">    resolve(time);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建reducer</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; GET_TIME_REQUEST, GET_TIME_FAILURE, GET_TIME_SUCCESS, GET_TIME_ERROR_CLEAR &#125; <span class="keyword">from</span> <span class="string">'../actions/constants'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initState = &#123;</span><br><span class="line">  loading: <span class="literal">false</span>,</span><br><span class="line">  errorInfo: <span class="string">''</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">getTime</span>(<span class="params">state = initState, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> loading = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">let</span> errorInfo = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> GET_TIME_REQUEST:</span><br><span class="line">      loading = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">return</span> &#123;...state, loading&#125;;</span><br><span class="line">    <span class="keyword">case</span> GET_TIME_FAILURE:</span><br><span class="line">    <span class="keyword">case</span> GET_TIME_SUCCESS:</span><br><span class="line">      loading = <span class="literal">false</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span>(action.error)&#123;</span><br><span class="line">        errorInfo = <span class="built_in">JSON</span>.stringify(action.error);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        errorInfo = <span class="string">''</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> &#123;...state, loading, errorInfo&#125;;</span><br><span class="line">    <span class="keyword">case</span> GET_TIME_ERROR_CLEAR:</span><br><span class="line">      errorInfo = <span class="string">''</span>;</span><br><span class="line">      <span class="keyword">return</span> &#123;...state, errorInfo&#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加Middleware<br>要在 Action 中使用 dispatch() 函数，需要中间件支持，我们选择使用 redux-thunk 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</span><br><span class="line"><span class="keyword">let</span> store = createStore(reducers, applyMiddleware(thunk));</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>redux-thunk 中间件不是唯一的方法。也可以使用 redux-promise 或者 redux-promise-middleware 来 dispatch Promise 替代函数。当然也可以写一个自定义的middleware。</p>
<h5 id="现在已经可以使用redux通过同步和异步Action管理数据了。"><a href="#现在已经可以使用redux通过同步和异步Action管理数据了。" class="headerlink" title="现在已经可以使用redux通过同步和异步Action管理数据了。"></a>现在已经可以使用redux通过同步和异步Action管理数据了。</h5><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p>更多API参考 <a href="http://redux.js.org/docs/introduction/" target="_blank" rel="external">Redux Document</a> <a href="http://cn.redux.js.org/index.html" target="_blank" rel="external">中文</a></p>
<p>示例代码地址 <a href="https://github.com/germanyt/react-study-example/tree/master/example/4" target="_blank" rel="external">Github</a></p>
<h2 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h2><p><a href="https://medium.com/@as790726/%E5%BE%9E-source-code-%E4%BE%86%E7%9C%8B-redux-%E7%9A%84%E9%81%8B%E8%A1%8C%E6%A9%9F%E5%88%B6-f5e0adc1b9f6#.o4l5v2hry" target="_blank" rel="external">從 source code 來看 Redux 更新 state 的運行機制</a><br><a href="https://medium.com/@as790726/%E5%BE%9E-source-code-%E4%BE%86%E7%9C%8B-react-redux-%E6%80%8E%E9%BA%BC%E8%AE%93-redux-%E8%B7%9F-react-%E5%85%B1%E8%88%9E-a0777b99463a#.hslbm6a96" target="_blank" rel="external">從 source code 來看 React-Redux 怎麼讓 Redux 跟 React 共舞</a><br><em>需要搬梯子</em></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://germanyt.github.io/React-study-notes-4/" data-id="ciozdneis0004kdwpycnlj8rz" class="article-share-link">Share</a>
      
        <a href="http://germanyt.github.io/React-study-notes-4/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redux/">Redux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-React-study-notes-3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/React-study-notes-3/" class="article-date">
  <time datetime="2016-05-18T01:51:58.000Z" itemprop="datePublished">2016-05-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/React-study-notes-3/">React 学习笔记 - 3</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>本节主要学习React Component相关内容</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li>create</li>
<li>props</li>
<li>state</li>
<li>Event system</li>
<li>lifecycle</li>
<li>context</li>
</ul>
<h2 id="create"><a href="#create" class="headerlink" title="create"></a>create</h2><p>有三种方式创建Component，实际开发中可根据实际情况选择</p>
<ol>
<li>class App extends React.Component {}<br>这是ES6中class 继承的写法</li>
<li>const App = React.createClass( {} )<br>这是通过createClass函数来创建的写法</li>
<li>无状态函数<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HelloMessage = (props) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello &#123;props.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">HelloMessage</span> <span class="attr">name</span>=<span class="string">"Sebastian"</span> /&gt;</span>, mountNode);</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>(1)(2)两种方法类似，具体区别参考官方文档中的 <a href="https://facebook.github.io/react/docs/reusable-components.html#es6-classes" target="_blank" rel="external">ES6 classes</a></p>
<p>(3)只适用于简单组件</p>
<h2 id="props"><a href="#props" class="headerlink" title="props"></a>props</h2><p>props的属性和方法来自于调用该 Component 时传递的内容。</p>
<h4 id="children"><a href="#children" class="headerlink" title="children"></a>children</h4><p>JSX有两种方式render Component: <code>&lt;App /&gt;</code> &amp; <code>&lt;App&gt;Hello world&lt;/App&gt;</code>，第一种 没有children属性，第二种children可以是 <code>字符串</code>或<code>DOM树</code>，为DOM树时children是一个和树对应的数组。</p>
<ul>
<li><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 需要先 import Parent Component</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Parent</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">code</span>&gt;</span>&amp;lt;Parent /&amp;gt;<span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Parent</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">Parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">code</span>&gt;</span>&amp;lt;Parent&amp;gt;字符串&amp;lt;/Parent&amp;gt;<span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>这是H1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>这是H2<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">code</span>&gt;</span>&amp;lt;Parent&amp;gt;DOM Tree&amp;lt;/Parent&amp;gt;<span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parent Component </span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Parent<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>This is children:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        &#123;this.props.children&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Parent;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="手动传递"><a href="#手动传递" class="headerlink" title="手动传递"></a>手动传递</h4><p>React中 this.porps的属性除children外都需要手动传递，手动传递有两种方式：</p>
<ol>
<li><p>“不定参数“形式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Receive <span class="keyword">from</span> <span class="string">'./receive.component'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Transfer</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> props = &#123;</span><br><span class="line">      a: <span class="number">1</span>,</span><br><span class="line">      b: <span class="string">'show Text'</span>,</span><br><span class="line">      c: [<span class="string">'tv'</span>, <span class="string">'ico'</span>, <span class="string">'co'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Transfer<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Receive</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Transfer;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>属性方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Receive <span class="keyword">from</span> <span class="string">'./receive.component'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Transfer</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Transfer<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Receive</span> <span class="attr">x</span>=<span class="string">"2002"</span> <span class="attr">y</span>=<span class="string">&#123;[</span>'<span class="attr">fb</span>', '<span class="attr">tw</span>', '<span class="attr">gl</span>']&#125; <span class="attr">z</span>=<span class="string">&#123;&#123;text:</span> '<span class="attr">hello</span>', <span class="attr">name:</span> '<span class="attr">Deo</span>'&#125;&#125; /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Transfer;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><em>Tips: v15已不再建议通过<code>setProps</code> <code>replaceProps</code>修改props。</em></p>
<h2 id="state"><a href="#state" class="headerlink" title="state"></a>state</h2><p>state用于维护当前组件的状态</p>
<p>初始化state, 需要用到<code>getInitialState</code>方法，但ES6 classes需要写在<code>constructor</code>中，示例如下：</p>
<ol>
<li><p>createClass</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> StateEs5 = React.createClass(&#123;</span><br><span class="line">	getInitialState() &#123;</span><br><span class="line">		<span class="keyword">return</span> &#123;count: <span class="number">0</span>&#125;;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	tick() &#123;</span><br><span class="line">		<span class="keyword">this</span>.setState(&#123;count: <span class="keyword">this</span>.state.count + <span class="number">1</span>&#125;);</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	render() &#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;this.tick&#125;</span>&gt;</span></span><br><span class="line">        Clicks: &#123;this.state.count&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> StateEs5;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ES6 classes</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">State</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;count: <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="comment">// this.tick = this.tick.bind(this);</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  tick() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;count: <span class="keyword">this</span>.state.count + <span class="number">1</span>&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.tick()&#125;&gt;</span><br><span class="line">        Clicks: &#123;this.state.count&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> State;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>除了初始化state的区别外，ES6 classes 不支持自动绑定，需要在绑定时使用箭头函数 <code>()=&gt;this.tick()</code> 或者在constructor中添加 <code>this.tick = this.tick.bind(this)</code>，两种方法任选其一。</p>
<h2 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h2><ul>
<li>绑定示例<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span></span><br><span class="line">  Clicks: &#123;this.state.count&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>支持的事件列表参看 <a href="https://facebook.github.io/react/docs/events.html" target="_blank" rel="external">官方文档</a></p>
<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><p>方法分为三类：</p>
<ol>
<li>初始化调用且只调用一次<ul>
<li>componentWillMount</li>
<li>componentDidMount</li>
</ul>
</li>
<li>更新props或state时调用（初始化时不调用）<ul>
<li>componentWillReceiveProps</li>
<li>shouldComponentUpdate (执行<code>forceUpdate</code>时该方法不执行)</li>
<li>componentWillUpdate</li>
<li>componentDidUpdate</li>
</ul>
</li>
<li>卸载组件时调用<ul>
<li>componentWillUnmount</li>
</ul>
</li>
</ol>
<p>附：<a href="https://facebook.github.io/react/docs/component-specs.html#lifecycle-methods" target="_blank" rel="external">官方文档</a></p>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><p>Context是一个高级实验功能，未来可能会有变化，请谨慎使用。</p>
<ul>
<li>示例代码<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Button = React.createClass(&#123;</span><br><span class="line">	contextTypes: &#123;</span><br><span class="line">		btnClass: React.PropTypes.string</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	render() &#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;</span>'<span class="attr">btn</span> ' + <span class="attr">this.context.btnClass</span>&#125;&gt;</span></span><br><span class="line">        &#123;this.props.children&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Message = React.createClass(&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;this.props.text&#125; <span class="tag">&lt;<span class="name">Button</span>&gt;</span>Delete<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MessageList = React.createClass(&#123;</span><br><span class="line">  childContextTypes: &#123;</span><br><span class="line">    btnClass: React.PropTypes.string</span><br><span class="line">  &#125;,</span><br><span class="line">  getChildContext() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;btnClass: <span class="string">"btn-default"</span>&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> children = [<span class="string">'Context 示例'</span>, <span class="string">'在祖先组件定义并设置值'</span>, <span class="string">'在子组件取得相应值'</span>].map(<span class="function"><span class="keyword">function</span>(<span class="params">message, index</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Message</span> <span class="attr">text</span>=<span class="string">&#123;message&#125;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> /&gt;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    return <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default MessageList;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p><code>props</code> <code>state</code> <code>context</code> 为Component提供了需要的数据</p>
<ul>
<li>state: 维护Component内部的状态</li>
<li>props: 属性或方法由父组件传递到Component</li>
<li>context: 方法或属性可继承祖先组件要传给后代的数据</li>
</ul>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p>更多API参考 <a href="https://facebook.github.io/react/docs/getting-started.html" target="_blank" rel="external">React Document</a></p>
<p>示例代码地址 <a href="https://github.com/germanyt/react-study-example/tree/master/example/3" target="_blank" rel="external">Github</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://germanyt.github.io/React-study-notes-3/" data-id="ciozdneiy0007kdwpqpw7ykxf" class="article-share-link">Share</a>
      
        <a href="http://germanyt.github.io/React-study-notes-3/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-React-study-notes-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/React-study-notes-2/" class="article-date">
  <time datetime="2016-05-17T02:39:14.000Z" itemprop="datePublished">2016-05-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/React-study-notes-2/">React 学习笔记 - 2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>本节中包含<code>React-router</code>控制React SPA路由。</p>
<p>关于<code>React-router</code>的详细使用，请查阅官方文档。</p>
<h2 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;Router, Route, IndexRoute, Link&#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to React!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/"</span>&gt;</span>Index<span class="tag">&lt;/<span class="name">Link</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/about"</span>&gt;</span>About<span class="tag">&lt;/<span class="name">Link</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        &#123;this.props.children&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">    	<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Index<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">About</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">    	<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>About<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render( (</span><br><span class="line">	&lt;Router&gt;</span><br><span class="line">	  &lt;Route path="/" component=&#123;App&#125;&gt;</span><br><span class="line">        &lt;IndexRoute component=&#123;Index&#125; /&gt;</span><br><span class="line">        &lt;Route path="about" component=&#123;About&#125; /&gt;</span><br><span class="line">	  &lt;/Route&gt;</span><br><span class="line">	&lt;/Router&gt; </span><br><span class="line">), document.getElementById('content') );</span><br></pre></td></tr></table></figure>
<p>运行以上代码能正常运行，URL地址为<code>http://hostname/#/pageRoute?_k=xxxx</code>，并在Console中看到以下警告<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning: [react-router] `Router` no longer defaults the history prop to hash history. Please use the `hashHistory` singleton instead. http://tiny.cc/router-defaulthistory</span><br></pre></td></tr></table></figure></p>
<p>根据以上提示信息，给Router Component添加history属性 <code>&lt;Router history={hashHistory}&gt;</code>，<em>使用hashHistory前需要先在react-router模块中引入</em>。</p>
<h4 id="URL格式"><a href="#URL格式" class="headerlink" title="URL格式"></a>URL格式</h4><ol>
<li>想要使用<code>http://hostname/pageRoute</code>格式的URL地址，只需用 <code>browserHistory</code> 替换掉hashHistory即可。</li>
<li>想要使用<code>http://hostname/projectName/pageRoute</code>格式的URL地址，需要引入 <code>useRouterHistory</code> 和 <code>history</code>模块的 <code>createHistory</code>，然后添加如下代码<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> history = useRouterHistory(createHistory)(&#123;</span><br><span class="line">  basename: <span class="string">'/projectName'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="多级路由"><a href="#多级路由" class="headerlink" title="多级路由"></a>多级路由</h2><p>本节需到的API：</p>
<ul>
<li>IndexRoute from react-router</li>
</ul>
<p>多级路由需要将次级对应的<code>&lt;Route /&gt;</code>节点作为父级的字节点<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;Router&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">component</span>=<span class="string">&#123;App&#125;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">IndexRoute</span> <span class="attr">component</span>=<span class="string">&#123;Index&#125;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"about"</span> <span class="attr">component</span>=<span class="string">&#123;About&#125;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"author"</span> <span class="attr">component</span>=<span class="string">&#123;Author&#125;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>并在父级<code>component</code>中输出<code>{this.props.children}</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">About</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>About<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        &#123;this.props.children&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>About Component</code>的文字出现在了<code>/about/author</code>中，怎么才能让<code>/about/author</code>不显示<code>About Component</code>的内容呢？<br>这时候就要用到<code>react-router</code>的另外一个Component <code>IndexRoute</code>，使用方法和 <code>Route</code> 相同，修改后的代码如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">"about"</span> component=&#123;About&#125;&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">IndexRoute</span> <span class="attr">component</span>=<span class="string">&#123;AboutIndex&#125;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"author"</span> <span class="attr">component</span>=<span class="string">&#123;Author&#125;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">About</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;this.props.children&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AboutIndex</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>About<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Author: Gavin<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="可变路由"><a href="#可变路由" class="headerlink" title="可变路由"></a>可变路由</h2><p>当需要路由<code>/user/gavin</code> <code>/user/david</code>等这类有规律且对应的Component是同一个的时候，可设置路由规则为<code>/user/:username</code><br>示例如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">"user"</span> component=&#123;User&#125;&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">IndexRoute</span> <span class="attr">component</span>=<span class="string">&#123;UserIndex&#125;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">":username"</span> <span class="attr">component</span>=<span class="string">&#123;UserCenter&#125;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;this.props.children&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserIndex</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>User Index<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserCenter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>User Name: &#123;this.props.params.username&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出<code>:username</code>对应的值在Component中通过<code>this.props.params.username</code>获取。</p>
<h2 id="Link"><a href="#Link" class="headerlink" title="Link"></a>Link</h2><p>应用内部链接需要使用<code>&lt;Link /&gt;</code>代替<code>&lt;a href=&quot;&quot;&gt;Link&lt;/a&gt;</code>，具体使用方法参考官方文档。</p>
<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><p>在1.x中提供了Mixin Lifecycle的方法，可以添加方法<code>routerWillLeave</code>，当离开当前Component触发，2.x版本已不再建议。<br>在2.x中相同需求的实现方法如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> RouteComponent = React.createClass(&#123;</span><br><span class="line">  contextTypes: &#123;</span><br><span class="line">    router: React.PropTypes.object.isRequired</span><br><span class="line">  &#125;,</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; route &#125; = <span class="keyword">this</span>.props</span><br><span class="line">    <span class="keyword">const</span> &#123; router &#125; = <span class="keyword">this</span>.context</span><br><span class="line">    router.setRouteLeaveHook(route, <span class="keyword">this</span>.routerWillLeave)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><em>Tips: 这里用 <code>React.createClass</code>, 而不是继承React.Component将在下一节中学习。</em></p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>React Router 还提供了一些有用的Component/Function：</p>
<ul>
<li><code>&lt;Redirect/&gt;</code> 路由跳转以便兼容旧路由</li>
<li><code>RouterContext</code> 通过<code>context.router</code>访问router的方法（具体的实现原理将在下一节中学习）</li>
<li><code>withRouter</code> 通过<code>this.props.router</code>访问router的方法</li>
</ul>
<p><em>Tips: router 类似于1.x的history，2.x不再推荐history和Mixins，后续版本可能会移除</em></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p>相关API参考 <a href="https://github.com/reactjs/react-router/blob/master/docs/API.md" target="_blank" rel="external">React Router Document</a></p>
<p>示例代码地址 <a href="https://github.com/germanyt/react-study-example/tree/master/example/2" target="_blank" rel="external">Github</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://germanyt.github.io/React-study-notes-2/" data-id="ciozdneiv0006kdwpgrfv5vaz" class="article-share-link">Share</a>
      
        <a href="http://germanyt.github.io/React-study-notes-2/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React-router/">React-router</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-React-study-notes-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/React-study-notes-1/" class="article-date">
  <time datetime="2016-05-16T09:39:37.000Z" itemprop="datePublished">2016-05-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/React-study-notes-1/">React 学习笔记 - 1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h2><ol>
<li>React <a href="https://facebook.github.io/react/docs/getting-started.html" target="_blank" rel="external">Document</a></li>
<li>React-router <a href="https://github.com/reactjs/react-router/tree/master/docs" target="_blank" rel="external">Document</a></li>
<li>Redux <a href="https://github.com/reactjs/redux" target="_blank" rel="external">Document</a></li>
<li>Webpack <a href="http://webpack.github.io/" target="_blank" rel="external">Document</a></li>
</ol>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>React SPA 开发，需要引入<code>React-router</code>控制路由，这里选择了<code>Redux</code>管理数据层，构建工具选择<code>Webpack</code>。</p>
<p>本节中包含React SPA 开发的相关配置和一个React的简单示例。</p>
<p><em>Tips ：文章中所有示例代码使用<code>ES6</code>。</em></p>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├──app</span><br><span class="line">|   ├──js</span><br><span class="line">|   |   ├──action</span><br><span class="line">|   |   ├──components</span><br><span class="line">|   |   ├──containers</span><br><span class="line">|   |   ├──reducer</span><br><span class="line">|   |   ├──store</span><br><span class="line">|   |   └──app.js</span><br><span class="line">|   └──index.html</span><br><span class="line">├──package.json</span><br><span class="line">├──server.js</span><br><span class="line">└──webpack.config.js</span><br></pre></td></tr></table></figure>
<h2 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a>Layout</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>react example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/build/app.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><em>Tips：示例中的样式使用bootstrap，在js中import，然后webpack构建</em></p>
<h2 id="Webpack配置"><a href="#Webpack配置" class="headerlink" title="Webpack配置"></a>Webpack配置</h2><ol>
<li>webpack 配置写入 webpack.config.js 文件</li>
<li>本地开发使用webpack-server启动web服务，监控文件变化</li>
</ol>
<h4 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line"></span><br><span class="line">  devtool: <span class="string">'inline-source-map'</span>, <span class="comment">// map 实际开发中，可使用NODE_ENV配置</span></span><br><span class="line"></span><br><span class="line">  entry: path.join(__dirname, <span class="string">'app'</span>, <span class="string">'js'</span>, <span class="string">'app.js'</span>),</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    path: __dirname + <span class="string">'/build/'</span>,</span><br><span class="line">    filename: <span class="string">'app.js'</span>,</span><br><span class="line">    chunkFilename: <span class="string">'[id].chunk.js'</span>,</span><br><span class="line">    publicPath: <span class="string">'/build/'</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    loaders: [</span><br><span class="line">      &#123; test: <span class="regexp">/\.(js|jsx)$/</span>, exclude: <span class="regexp">/node_modules/</span>, loader: <span class="string">'babel'</span>, query: &#123;</span><br><span class="line">          presets: [<span class="string">'es2015'</span>,<span class="string">'react'</span>],</span><br><span class="line">          plugins: [<span class="string">'transform-object-rest-spread'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="comment">//使用babel把 jsx和es6 转换为 es5</span></span><br><span class="line">      &#123; test: <span class="regexp">/\.css$/</span>, loader: <span class="string">'style!css'</span> &#125;,</span><br><span class="line">      &#123; test: <span class="regexp">/\.(woff2?|svg)$/</span>, loader: <span class="string">'url?limit=10000'</span> &#125;,</span><br><span class="line">      &#123; test: <span class="regexp">/\.(ttf|eot)$/</span>, loader: <span class="string">'file'</span> &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  resolve: &#123;</span><br><span class="line">    extensions: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.jsx'</span>] <span class="comment">//处理文件扩展名</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// new webpack.optimize.CommonsChunkPlugin('shared.js'),</span></span><br><span class="line">    <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">      <span class="string">'process.env.NODE_ENV'</span>: <span class="built_in">JSON</span>.stringify(process.env.NODE_ENV || <span class="string">'development'</span>),</span><br><span class="line">      __DEV__: <span class="built_in">JSON</span>.stringify(<span class="built_in">JSON</span>.parse(process.env.DEBUG || <span class="string">'false'</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="webpack-server"><a href="#webpack-server" class="headerlink" title="webpack-server"></a>webpack-server</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> rewrite = <span class="built_in">require</span>(<span class="string">'express-urlrewrite'</span>)</span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">var</span> webpackDevMiddleware = <span class="built_in">require</span>(<span class="string">'webpack-dev-middleware'</span>)</span><br><span class="line"><span class="keyword">var</span> WebpackConfig = <span class="built_in">require</span>(<span class="string">'./webpack.config'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"></span><br><span class="line">app.use(webpackDevMiddleware(webpack(WebpackConfig), &#123;</span><br><span class="line">  publicPath: <span class="string">'/build/'</span>,</span><br><span class="line">  stats: &#123;</span><br><span class="line">    colors: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.use(express.static(__dirname))</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/*'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>)</span>&#123;</span><br><span class="line">  response.sendFile(path.resolve(__dirname, <span class="string">'app'</span>, <span class="string">'index.html'</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8080</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Server listening on http://localhost:8080, Ctrl+C to stop'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="依赖模块"><a href="#依赖模块" class="headerlink" title="依赖模块"></a>依赖模块</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"babel-cli"</span>: <span class="string">"^6.7.5"</span>,</span><br><span class="line">    <span class="attr">"babel-core"</span>: <span class="string">"^6.7.6"</span>,</span><br><span class="line">    <span class="attr">"babel-eslint"</span>: <span class="string">"^5.0.4"</span>,</span><br><span class="line">    <span class="attr">"babel-loader"</span>: <span class="string">"^6.2.4"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-add-module-exports"</span>: <span class="string">"^0.1.2"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-dev-expression"</span>: <span class="string">"^0.2.1"</span>,</span><br><span class="line">    <span class="attr">"babel-plugin-transform-object-rest-spread"</span>: <span class="string">"^6.8.0"</span>,</span><br><span class="line">    <span class="attr">"babel-polyfill"</span>: <span class="string">"^6.7.4"</span>,</span><br><span class="line">    <span class="attr">"babel-preset-es2015"</span>: <span class="string">"^6.6.0"</span>,</span><br><span class="line">    <span class="attr">"babel-preset-es2015-loose"</span>: <span class="string">"^7.0.0"</span>,</span><br><span class="line">    <span class="attr">"babel-preset-es2015-loose-native-modules"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="attr">"babel-preset-react"</span>: <span class="string">"^6.5.0"</span>,</span><br><span class="line">    <span class="attr">"babel-register"</span>: <span class="string">"^6.7.2"</span>,</span><br><span class="line">    <span class="attr">"bootstrap"</span>: <span class="string">"^3.3.6"</span>,</span><br><span class="line">    <span class="attr">"bundle-loader"</span>: <span class="string">"^0.5.4"</span>,</span><br><span class="line">    <span class="attr">"codecov.io"</span>: <span class="string">"^0.1.6"</span>,</span><br><span class="line">    <span class="attr">"coveralls"</span>: <span class="string">"^2.11.9"</span>,</span><br><span class="line">    <span class="attr">"css-loader"</span>: <span class="string">"^0.23.1"</span>,</span><br><span class="line">    <span class="attr">"eslint"</span>: <span class="string">"^1.10.3"</span>,</span><br><span class="line">    <span class="attr">"eslint-config-rackt"</span>: <span class="string">"^1.1.1"</span>,</span><br><span class="line">    <span class="attr">"eslint-plugin-react"</span>: <span class="string">"^3.16.1"</span>,</span><br><span class="line">    <span class="attr">"expect"</span>: <span class="string">"^1.18.0"</span>,</span><br><span class="line">    <span class="attr">"express"</span>: <span class="string">"^4.13.4"</span>,</span><br><span class="line">    <span class="attr">"file-loader"</span>: <span class="string">"^0.8.5"</span>,</span><br><span class="line">    <span class="attr">"gzip-size"</span>: <span class="string">"^3.0.0"</span>,</span><br><span class="line">    <span class="attr">"history"</span>: <span class="string">"^2.1.0"</span>,</span><br><span class="line">    <span class="attr">"isomorphic-fetch"</span>: <span class="string">"^2.2.1"</span>,</span><br><span class="line">    <span class="attr">"isparta-loader"</span>: <span class="string">"^2.0.0"</span>,</span><br><span class="line">    <span class="attr">"pretty-bytes"</span>: <span class="string">"^3.0.1"</span>,</span><br><span class="line">    <span class="attr">"qs"</span>: <span class="string">"^6.1.0"</span>,</span><br><span class="line">    <span class="attr">"react"</span>: <span class="string">"^15.0.0"</span>,</span><br><span class="line">    <span class="attr">"react-addons-css-transition-group"</span>: <span class="string">"^15.0.0"</span>,</span><br><span class="line">    <span class="attr">"react-addons-test-utils"</span>: <span class="string">"^15.0.0"</span>,</span><br><span class="line">    <span class="attr">"react-bootstrap"</span>: <span class="string">"^0.29.3"</span>,</span><br><span class="line">    <span class="attr">"react-dom"</span>: <span class="string">"^15.0.0"</span>,</span><br><span class="line">    <span class="attr">"react-redux"</span>: <span class="string">"^4.4.5"</span>,</span><br><span class="line">    <span class="attr">"react-router"</span>: <span class="string">"^2.4.0"</span>,</span><br><span class="line">    <span class="attr">"react-router-bootstrap"</span>: <span class="string">"^0.23.0"</span>,</span><br><span class="line">    <span class="attr">"redux"</span>: <span class="string">"^3.5.2"</span>,</span><br><span class="line">    <span class="attr">"redux-logger"</span>: <span class="string">"^2.6.1"</span>,</span><br><span class="line">    <span class="attr">"redux-thunk"</span>: <span class="string">"^2.1.0"</span>,</span><br><span class="line">    <span class="attr">"rimraf"</span>: <span class="string">"^2.5.2"</span>,</span><br><span class="line">    <span class="attr">"style-loader"</span>: <span class="string">"^0.13.1"</span>,</span><br><span class="line">    <span class="attr">"url-loader"</span>: <span class="string">"^0.5.7"</span>,</span><br><span class="line">    <span class="attr">"webpack"</span>: <span class="string">"^1.12.14"</span>,</span><br><span class="line">    <span class="attr">"webpack-dev-middleware"</span>: <span class="string">"^1.6.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>到这里配置部分已经结束，接下来写一个小demo 来试试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to React!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render( ( <span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span> ), document.getElementById('content') );</span></span><br></pre></td></tr></table></figure>
<p>示例代码地址 <a href="https://github.com/germanyt/react-study-example/tree/master/example/1" target="_blank" rel="external">Github</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://germanyt.github.io/React-study-notes-1/" data-id="ciozdneip0003kdwpqc85kmag" class="article-share-link">Share</a>
      
        <a href="http://germanyt.github.io/React-study-notes-1/#disqus_thread" class="article-comment-link">留言</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React-router/">React-router</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redux/">Redux</a></li></ul>

    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React-router/">React-router</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redux/">Redux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Translate/">Translate</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/React/" style="font-size: 16.67px;">React</a> <a href="/tags/React-router/" style="font-size: 13.33px;">React-router</a> <a href="/tags/Redux/" style="font-size: 13.33px;">Redux</a> <a href="/tags/Translate/" style="font-size: 10px;">Translate</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/How-to-write-your-own-Virtual-DOM/">如何自己实现虚拟DOM</a>
          </li>
        
          <li>
            <a href="/React-study-notes-4/">React 学习笔记 - 4</a>
          </li>
        
          <li>
            <a href="/React-study-notes-3/">React 学习笔记 - 3</a>
          </li>
        
          <li>
            <a href="/React-study-notes-2/">React 学习笔记 - 2</a>
          </li>
        
          <li>
            <a href="/React-study-notes-1/">React 学习笔记 - 1</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Gavin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'gavin8';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>